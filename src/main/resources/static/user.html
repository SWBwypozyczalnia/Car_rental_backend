<!DOCTYPE HTML>
<html lang="pl">
<head>
    <title>Dane użytkownika</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="assets/css/main.css" />
    <noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
    <style>
        /* Dodatkowe style */
        #user-info, #user-reservations {
            margin-left: 30px; /* Odstęp od lewej krawędzi */
        }
        #reservations-details {
            margin: 0 30px; /* Marginesy po bokach */
        }
        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 10px;
        }
        .pagination button {
            margin: 0 5px;
            padding: 5px 10px;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f4f4f9;
            color: #333;
            margin: 0;
            padding: 0;
        }

        #wrapper {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        h2 {
            color: #444;
            margin-bottom: 20px;
        }

        .section {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            padding: 20px;
        }

        .user-details {
            line-height: 1.8;
        }

        .user-details strong {
            color: #007BFF;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        table th, table td {
            padding: 10px;
            text-align: left;
            border: 1px solid #ddd;
        }

        table th {
            background-color: #007BFF;
            color: white;
        }

        table tbody tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        table tbody tr:hover {
            background-color: #f1f1f1;
        }
    </style>
</head>
<body>
<div id="wrapper">
    <!-- Header -->
    <header id="header">
        <div class="inner">
            <!-- Logo -->
            <a href="index.html" class="logo">
                <span class="symbol"><img src="images/logo.svg" alt="" /></span>
                <span class="title">Użytkownik</span>
            </a>

            <!-- Nav -->
            <nav>
                <ul>
                    <li><a href="#menu">Menu</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Menu -->
    <nav id="menu">
        <h2>Menu</h2>
        <ul id="menu-list"></ul>
    </nav>

    <!-- Dane użytkownika -->
    <div class="section">
        <h2>Dane użytkownika</h2>
        <div id="user-details" class="user-details">
            Ładowanie danych użytkownika...
        </div>
    </div>

    <!-- Rezerwacje użytkownika -->
    <div class="section">
        <h2>Rezerwacje użytkownika</h2>
        <div id="reservations-details">
            Ładowanie rezerwacji...
        </div>
    </div>
</div>

<!-- Skrypty -->
<script src="config.js"></script>
<script>
    // Funkcja do pobrania danych użytkownika
    function fetchUserData() {
        fetch(`${API_BASE_URL}/users`, {
            method: "GET",
            credentials: "include" // Dodanie ciasteczek do żądania
        })
            .then(response => {
                if (response.ok) {
                    return response.json();
                } else {
                    return response.text().then(text => { throw new Error(text); });
                }
            })
            .then(data => {
                const userDetails = `
                <p><strong>ID:</strong> ${data.id}</p>
                <p><strong>Imię:</strong> ${data.firstname}</p>
                <p><strong>Nazwisko:</strong> ${data.lastname}</p>
                <p><strong>Email:</strong> ${data.email}</p>
                <p><strong>Telefon:</strong> ${data.phoneNumber}</p>
            `;
                document.getElementById("user-details").innerHTML = userDetails;
            })
            .catch(error => {
                console.error("Błąd podczas pobierania danych użytkownika:", error);
                document.getElementById("user-details").textContent = "Nie udało się pobrać danych użytkownika.";
            });
    }

    // Funkcja do pobrania rezerwacji użytkownika
    function fetchUserReservations() {
        const userId = localStorage.getItem("userId");

        if (!userId) {
            document.getElementById("reservations-details").textContent = "Nie znaleziono użytkownika.";
            return;
        }

        fetch(`${API_BASE_URL}/reservation/user/${userId}`, {
            method: "GET",
            credentials: "include"
        })
            .then(response => {
                if (response.ok) {
                    return response.json();
                } else {
                    return response.text().then(text => { throw new Error(text); });
                }
            })
            .then(reservations => {
                displayReservations(reservations);
            })
            .catch(error => {
                console.error("Błąd podczas pobierania rezerwacji:", error);
                document.getElementById("reservations-details").textContent = "Nie udało się pobrać rezerwacji użytkownika.";
            });
    }

    // Funkcja do wyświetlania rezerwacji w tabeli
    function displayReservations(reservations) {
        const reservationsContainer = document.getElementById("reservations-details");

        if (!reservations || reservations.length === 0) {
            reservationsContainer.innerHTML = "Brak rezerwacji dla tego użytkownika.";
            return;
        }

        let tableHTML = `
            <table>
                <thead>
                    <tr>
                        <th>ID Rezerwacji</th>
                        <th>Samochód</th>
                        <th>Data Rezerwacji</th>
                        <th>Data Rozpoczęcia</th>
                        <th>Data Zakończenia</th>
                        <th>Odebrano</th>
                        <th>Zwrócono</th>
                    </tr>
                </thead>
                <tbody>
        `;

        reservations.forEach(reservation => {
            tableHTML += `
                <tr>
                    <td>${reservation.id}</td>
                    <td>${reservation.carDTO.make} ${reservation.carDTO.model}</td>
                    <td>${reservation.reservationDate}</td>
                    <td>${reservation.startingDate}</td>
                    <td>${reservation.endDate}</td>
                    <td>${reservation.picked_up ? "Tak" : "Nie"}</td>
                    <td>${reservation.returned ? "Tak" : "Nie"}</td>
                </tr>
            `;
        });

        tableHTML += `
                </tbody>
            </table>
        `;

        reservationsContainer.innerHTML = tableHTML;
    }

    // Wywołanie funkcji po załadowaniu strony
    window.onload = function () {
        fetchUserData();
        fetchUserReservations();
    };
</script>
<script src="menuHandler.js"></script>
<script src="assets/js/jquery.min.js"></script>
<script src="assets/js/browser.min.js"></script>
<script src="assets/js/breakpoints.min.js"></script>
<script src="assets/js/util.js"></script>
<script src="assets/js/main.js"></script>
</body>
</html>
